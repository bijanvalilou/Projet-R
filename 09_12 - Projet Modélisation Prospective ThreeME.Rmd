---
title: "Projet ThreeME"
output: html_document
---

```{r}

library(readxl)
library(tibble)
library(ggplot2)

```


```{r}

sheet_names <- excel_sheets("Page Reporting_shock des scénarios.xlsx")
nb_sheets <- length(sheet_names)
for (i in 1:nb_sheets){  
        name <- sheet_names[i] 
        name2 <- paste0(name) 
        data <- read_excel("Page Reporting_shock des scénarios.xlsx", sheet = i) 
        data <- column_to_rownames(data, var = '_date_')
        colnames(data) <- c(2015:2050)
        data <- data.frame(t(data))
        data$year <- c(2015:2050)
        assign(name2,data)
        rm(name,name2,data)
} 

Sc1 <- (S1/Baseline-1)*100
Sc2 <- (S2/Baseline-1)*100
Sc3 <- (S3/Baseline-1)*100
Sc4 <- (S4/Baseline-1)*100
Sc5 <- (S5/Baseline-1)*100
Sc6 <- (S6/Baseline-1)*100
Sc1$year <- c(2015:2050)
Sc2$year <- c(2015:2050)
Sc3$year <- c(2015:2050)
Sc4$year <- c(2015:2050)
Sc5$year <- c(2015:2050)
Sc6$year <- c(2015:2050)
```




```{r}
#faut qjouter l'unite 
ggplot() + 
  geom_line( data = Sc1, aes(x = year,y = gdp_2, group = 1, color = "Tax_sansdis")) + 
  geom_line( data = Sc2, aes(x = year,y = gdp_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( data = Sc3, aes(x = year,y = gdp_2, group = 1, color = "Sub_sansdis")) + 
  geom_line( data = Sc4, aes(x = year,y = gdp_2, group = 1, color = "Sub_avecdis")) + 
  geom_line( data = Sc5, aes(x = year,y = gdp_2, group = 1, color = "ENR")) + 
  geom_line( data = Sc6, aes(x = year,y = gdp_2, group = 1, color = "melange")) +
  labs(y = "Variation de GDP en %", title = "Evolution de variation de GDP") +
  scale_x_continuous(breaks=seq(2015,2050,5))
```

```{r}
ggplot() + 
  geom_line( data = Sc1, aes(x = year,y = ems_co2_2, group = 1, color = "Tax_sansdis")) + 
  geom_line( data = Sc2, aes(x = year,y = ems_co2_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( data = Sc3, aes(x = year,y = ems_co2_2, group = 1, color = "Sub_sansdis")) + 
  geom_line( data = Sc4, aes(x = year,y = ems_co2_2, group = 1, color = "Sub_avecdis")) + 
  geom_line( data = Sc5, aes(x = year,y = ems_co2_2, group = 1, color = "ENR")) + 
  geom_line( data = Sc6, aes(x = year,y = ems_co2_2, group = 1, color = "melange")) +
  labs(y = "Variation d'émission en %", title = "Evolution de variation d'émission") +
  scale_x_continuous(breaks=seq(2015,2050,5))


```

```{r}

IndEne_0 <- (Baseline[,"ci_toe_ind_0"]+Baseline[,"ci_toe_trsp_0"]+Baseline[,"ci_toe_ser_0"]+Baseline[,"ch_toe_0"])/Baseline[,"gdp_0"]
IndEne_1 <- (S1[,"ci_toe_ind_2"]+S1[,"ci_toe_trsp_2"]+S1[,"ci_toe_ser_2"]+S1[,"ch_toe_2"])/S1[,"gdp_2"]
IndEne_2 <- (S2[,"ci_toe_ind_2"]+S2[,"ci_toe_trsp_2"]+S2[,"ci_toe_ser_2"]+S2[,"ch_toe_2"])/S2[,"gdp_2"]
IndEne_3 <- (S3[,"ci_toe_ind_2"]+S3[,"ci_toe_trsp_2"]+S3[,"ci_toe_ser_2"]+S3[,"ch_toe_2"])/S3[,"gdp_2"]
IndEne_4 <- (S4[,"ci_toe_ind_2"]+S4[,"ci_toe_trsp_2"]+S4[,"ci_toe_ser_2"]+S4[,"ch_toe_2"])/S4[,"gdp_2"]
IndEne_5 <- (S5[,"ci_toe_ind_2"]+S5[,"ci_toe_trsp_2"]+S5[,"ci_toe_ser_2"]+S5[,"ch_toe_2"])/S5[,"gdp_2"]
IndEne_6 <- (S6[,"ci_toe_ind_2"]+S6[,"ci_toe_trsp_2"]+S6[,"ci_toe_ser_2"]+S6[,"ch_toe_2"])/S6[,"gdp_2"]

IndEne_1 <- (IndEne_1/IndEne_0-1)*100
IndEne_2 <- (IndEne_2/IndEne_0-1)*100
IndEne_3 <- (IndEne_3/IndEne_0-1)*100
IndEne_4 <- (IndEne_4/IndEne_0-1)*100
IndEne_5 <- (IndEne_5/IndEne_0-1)*100
IndEne_6 <- (IndEne_6/IndEne_0-1)*100



ggplot() + 
  geom_line( data = Sc1, aes(x = rownames(S1),y = IndEne_1, group = 1, color = "Tax_sansdis")) + 
  geom_line( data = Sc2, aes(x = rownames(S2),y = IndEne_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( data = Sc3, aes(x = rownames(S3),y = IndEne_3, group = 1, color = "Sub_sansdis")) + 
  geom_line( data = Sc4, aes(x = rownames(S4),y = IndEne_4, group = 1, color = "Sub_avecdis")) + 
  geom_line( data = Sc5, aes(x = rownames(S5),y = IndEne_5, group = 1, color = "ENR")) + 
  geom_line( data = Sc6, aes(x = rownames(S6),y = IndEne_6, group = 1, color = "melange")) +
  labs(x = "year", y = "Energy Insensity", title = "Energy intensity") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))



```

```{r}

z <- c(Baseline[,"ci_toe_ind_0"],Baseline[,"ci_toe_trsp_0"],Baseline[,"ci_toe_ser_0"],Baseline[,"ch_toe_0"])
x <- rep(rownames(Baseline), times = 4)
y <- rep(c("Industrie et agriculture","Transports","Services","Ménages"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Cons. énergétique en %", title = "Cons. énergétique par secteurs - Baseline") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```

```{r}

#z <- c(Baseline[,"y_toe_coil_trsf_0"],Baseline[,"y_toe_cfut_trsf_0"],Baseline[,"y_toe_cfuh_trsf_0"],Baseline[,"y_toe_cgas_trsf_0"],Baseline[,"y_toe_cele_ele_0"],Baseline[,"m_toe_0"])
z <- c(Baseline[,"y_toe_coil_trsf_0"],Baseline[,"y_toe_cfut_trsf_0"],Baseline[,"y_toe_cfuh_trsf_0"],Baseline[,"y_toe_cgas_trsf_0"],Baseline[,"y_toe_cele_ele_0"])
x <- rep(rownames(Baseline), times = 5)
#y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité","Importations  nettes"), each = 36)
y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Prod. énergétique en %", title = "Prouction énergétique par type d'énergie - Baseline") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```

```{r}

z <- c(Baseline[,"ci_toe_coil_0"], Baseline[,"ci_toe_cfut_0"] + Baseline[,"ch_toe_cfut_0"], Baseline[,"ci_toe_cfuh_0"] + Baseline[,"ch_toe_cfuh_0"], Baseline[,"ci_toe_cgas_0"] + Baseline[,"ch_toe_cgas_0"], Baseline[,"ci_toe_cele_0"] + Baseline[,"ch_toe_cele_0"] )
x <- rep(rownames(Baseline), times = 5)
y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Cons. énergétique en %", title = "Cons. énergétique par type d'énergie - Baseline") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))
```






```{r}

z <- c(S1[,"ci_toe_ind_2"],S1[,"ci_toe_trsp_2"],S1[,"ci_toe_ser_2"],S1[,"ch_toe_2"])
x <- rep(rownames(S1), times = 4)
y <- rep(c("Industrie et agriculture","Transports","Services","Ménages"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) +
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE))+ 
  labs(x = "year", y = "Cons. finale énergétique en %", title = "Cons. énergétique par secteur - Tax sans distribution") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```

```{r}

z <- c(S1[,"y_toe_coil_trsf_2"],S1[,"y_toe_cfut_trsf_2"],S1[,"y_toe_cfuh_trsf_2"],S1[,"y_toe_cgas_trsf_2"],S1[,"y_toe_cele_ele_2"],S1[,"m_toe_2"])
x <- rep(rownames(Baseline), times = 6)
y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité","Importations  nettes"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Prod. énergétique en %", title = "Prod. énergétique par type d'énergie - Tax sans distribution") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))
```



```{r}



z <- c(S5[,"ci_toe_ind_2"],S5[,"ci_toe_trsp_2"],S5[,"ci_toe_ser_2"],S5[,"ch_toe_2"])
x <- rep(rownames(S1), times = 4)
y <- rep(c("Industrie et agriculture","Transports","Services","Ménages"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Cons. énergétique en %", title = "Cons. énergétique par secteur - énergie renouvelable") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))


```

```{r}
z <- c(S6[,"y_toe_coil_trsf_2"],S6[,"y_toe_cfut_trsf_2"],S6[,"y_toe_cfuh_trsf_2"],S6[,"y_toe_cgas_trsf_2"],S6[,"y_toe_cele_ele_2"])
x <- rep(rownames(Baseline), times = 5)
y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Prod. énergétique en %", title = "Prod. énergétique par type d'énergie - énergie renouvelable") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))
```

```{r}

z <- c(S6[,"ci_toe_coil_2"], S6[,"ci_toe_cfut_2"] + S6[,"ch_toe_cfut_2"], S6[,"ci_toe_cfuh_2"] + S6[,"ch_toe_cfuh_2"], S6[,"ci_toe_cgas_2"] + S6[,"ch_toe_cgas_2"], S6[,"ci_toe_cele_2"] + S6[,"ch_toe_cele_2"] )
x <- rep(rownames(Baseline), times = 5)
y <- rep(c("Pétrole brut","Carburants pourle transport","Carburants pour d'autres usages","Gaz naturel","Electricité"), each = 36)

ggplot(
  mapping = aes(
    x = factor(x), 
               y = z, 
               fill = y,
    group = 1)
  ) + 
  geom_bar(stat = 'identity', position = 'fill') + guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Cons. énergétique en %", title = "Cons. énergétique par type d'énergie - Baseline") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))
```

```{r}

Ind_Ene_0 <- (Baseline[,"ci_toe_ind_0"]+Baseline[,"ci_toe_trsp_0"]+Baseline[,"ci_toe_ser_0"]+Baseline[,"ch_toe_0"])/Baseline[,"gdp_0"]
Ind_car_0 <- Baseline[,"ems_co2_0"]/((Baseline[,"ci_toe_ind_0"]+Baseline[,"ci_toe_trsp_0"]+Baseline[,"ci_toe_ser_0"]+Baseline[,"ch_toe_0"]))
Pib_cap_0 <- Baseline[,"gdp_0"]/Baseline[,"pop"]


Ind_Ene_1 <- (S1[,"ci_toe_ind_2"]+S1[,"ci_toe_trsp_2"]+S1[,"ci_toe_ser_2"]+S1[,"ch_toe_2"])/S1[,"gdp_2"]
Ind_car_1 <- S1[,"ems_co2_2"]/((S1[,"ci_toe_ind_2"]+S1[,"ci_toe_trsp_2"]+S1[,"ci_toe_ser_2"]+S1[,"ch_toe_2"]))
Pib_cap_1 <- S1[,"gdp_2"]/S1[,"pop"]

Ind_Ene_2 <- (S2[,"ci_toe_ind_2"]+S2[,"ci_toe_trsp_2"]+S2[,"ci_toe_ser_2"]+S2[,"ch_toe_2"])/S2[,"gdp_2"]
Ind_car_2 <- S2[,"ems_co2_2"]/((S2[,"ci_toe_ind_2"]+S2[,"ci_toe_trsp_2"]+S2[,"ci_toe_ser_2"]+S2[,"ch_toe_2"]))
Pib_cap_2 <- S2[,"gdp_2"]/S2[,"pop"]

Ind_Ene_3 <- (S3[,"ci_toe_ind_2"]+S3[,"ci_toe_trsp_2"]+S3[,"ci_toe_ser_2"]+S3[,"ch_toe_2"])/S3[,"gdp_2"]
Ind_car_3 <- S3[,"ems_co2_2"]/((S3[,"ci_toe_ind_2"]+S3[,"ci_toe_trsp_2"]+S3[,"ci_toe_ser_2"]+S3[,"ch_toe_2"]))
Pib_cap_3 <- S3[,"gdp_2"]/S3[,"pop"]

Ind_Ene_4 <- (S4[,"ci_toe_ind_2"]+S4[,"ci_toe_trsp_2"]+S4[,"ci_toe_ser_2"]+S4[,"ch_toe_2"])/S4[,"gdp_2"]
Ind_car_4 <- S4[,"ems_co2_2"]/((S4[,"ci_toe_ind_2"]+S4[,"ci_toe_trsp_2"]+S4[,"ci_toe_ser_2"]+S4[,"ch_toe_2"]))
Pib_cap_4 <- S4[,"gdp_2"]/S4[,"pop"]

Ind_Ene_5 <- (S5[,"ci_toe_ind_2"]+S5[,"ci_toe_trsp_2"]+S5[,"ci_toe_ser_2"]+S5[,"ch_toe_2"])/S5[,"gdp_2"]
Ind_car_5 <- S5[,"ems_co2_2"]/((S5[,"ci_toe_ind_2"]+S5[,"ci_toe_trsp_2"]+S5[,"ci_toe_ser_2"]+S5[,"ch_toe_2"]))
Pib_cap_5 <- S5[,"gdp_2"]/S5[,"pop"]

Ind_Ene_6 <- (S6[,"ci_toe_ind_2"]+S6[,"ci_toe_trsp_2"]+S6[,"ci_toe_ser_2"]+S6[,"ch_toe_2"])/S6[,"gdp_2"]
Ind_car_6 <- S6[,"ems_co2_2"]/((S6[,"ci_toe_ind_2"]+S6[,"ci_toe_trsp_2"]+S6[,"ci_toe_ser_2"]+S6[,"ch_toe_2"]))
Pib_cap_6 <- S6[,"gdp_2"]/S6[,"pop"]

```

```{r}


ggplot() + 
  geom_line( data = Sc1, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "Tax_sansdis")) + 
  geom_line( data = Sc2, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( data = Sc3, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "Sub_sansdis")) + 
  geom_line( data = Sc4, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "Sub_avecdis")) + 
  geom_line( data = Sc5, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "ENR")) + 
  geom_line( data = Sc6, aes(x = rownames(S1),y = ems_co2_2, group = 1, color = "melange")) +
  labs(x = "year", y = "Variation d'émission CO2 en%", title = "L'évolution de la variation d'emission") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```


```{r}

ln_indene_1 <- (Ind_Ene_1/Ind_Ene_0 - 1)*100
ln_indene_2 <- (Ind_Ene_2/Ind_Ene_0 - 1)*100
ln_indene_3 <- (Ind_Ene_3/Ind_Ene_0 - 1)*100
ln_indene_4 <- (Ind_Ene_4/Ind_Ene_0 - 1)*100
ln_indene_5 <- (Ind_Ene_5/Ind_Ene_0 - 1)*100
ln_indene_6 <- (Ind_Ene_6/Ind_Ene_0 - 1)*100


ggplot() + 
  geom_line( aes(x = rownames(S1),y = ln_indene_1, group = 1, color = "Tax_sansdis")) + 
  geom_line( aes(x = rownames(S2),y = ln_indene_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( aes(x = rownames(S3),y = ln_indene_3, group = 1, color = "Sub_sansdis")) + 
  geom_line( aes(x = rownames(S4),y = ln_indene_4, group = 1, color = "Sub_avecdis")) + 
  geom_line( aes(x = rownames(S5),y = ln_indene_5, group = 1, color = "ENR")) + 
  geom_line( aes(x = rownames(S6),y = ln_indene_6, group = 1, color = "melange")) +
  labs(x = "year", y = "Intensite d'energie", title = "L'impact sur le variation d'emission - Intensite d'energie") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```

```{r}

ln_pibcar_1 <- (Pib_cap_1/Pib_cap_0 - 1)*100
ln_pibcar_2 <- (Pib_cap_2/Pib_cap_0 - 1)*100
ln_pibcar_3 <- (Pib_cap_3/Pib_cap_0 - 1)*100
ln_pibcar_4 <- (Pib_cap_4/Pib_cap_0 - 1)*100
ln_pibcar_5 <- (Pib_cap_5/Pib_cap_0 - 1)*100
ln_pibcar_6 <- (Pib_cap_6/Pib_cap_0 - 1)*100



ggplot() + 
  geom_line( aes(x = rownames(S1),y = ln_pibcar_1, group = 1, color = "Tax_sansdis")) + 
  geom_line( aes(x = rownames(S2),y = ln_pibcar_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( aes(x = rownames(S3),y = ln_pibcar_3, group = 1, color = "Sub_sansdis")) + 
  geom_line( aes(x = rownames(S4),y = ln_pibcar_4, group = 1, color = "Sub_avecdis")) + 
  geom_line( aes(x = rownames(S5),y = ln_pibcar_5, group = 1, color = "ENR")) + 
  geom_line( aes(x = rownames(S6),y = ln_pibcar_6, group = 1, color = "melange")) +
  labs(x = "year", y = "PIB par tete", title = "L'impact sur le variation d'emission - PIB par tete") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))

```

```{r}

ln_ind_car_1 <- (Ind_car_1/Ind_car_0 - 1)*100
ln_ind_car_2 <- (Ind_car_2/Ind_car_0 - 1)*100
ln_ind_car_3 <- (Ind_car_3/Ind_car_0 - 1)*100
ln_ind_car_4 <- (Ind_car_4/Ind_car_0 - 1)*100
ln_ind_car_5 <- (Ind_car_5/Ind_car_0 - 1)*100
ln_ind_car_6 <- (Ind_car_6/Ind_car_0 - 1)*100


ggplot() + 
  geom_line( aes(x = rownames(S1),y = ln_ind_car_1, group = 1, color = "Tax_sansdis")) + 
  geom_line( aes(x = rownames(S2),y = ln_ind_car_2, group = 1, color = "Tax_avecdis")) + 
  geom_line( aes(x = rownames(S3),y = ln_ind_car_3, group = 1, color = "Sub_sansdis")) + 
  geom_line( aes(x = rownames(S4),y = ln_ind_car_4, group = 1, color = "Sub_avecdis")) + 
  geom_line( aes(x = rownames(S5),y = ln_ind_car_5, group = 1, color = "ENR")) + 
  geom_line( aes(x = rownames(S6),y = ln_ind_car_6, group = 1, color = "melange")) +
  labs(x = "year", y = "Intensite de carbon", title = "L'impact sur le variation d'emission - intensite de carbon") + 
  theme(axis.text.x =  element_text(angle=45, hjust=1, vjust=1))
```




```{r}

w <- (S1[,"ems_co2_2"]-Baseline[,"ems_co2_0"])/(log(S1[,"ems_co2_2"])-log(Baseline[,"ems_co2_0"]))
w[1:6] = 0
delta_pibcap_1 <- w*log(Pib_cap_1/Pib_cap_0)
delta_intene_1 <- w*log(Ind_Ene_1/Ind_Ene_0)
delta_intcar_1 <- w*log(Ind_car_1/Ind_car_0)


z <- c(delta_pibcap_1, delta_intene_1, delta_intcar_1)
x <- rep(S1[,"year"], times = 3)
y <- rep(c("PIB par tête","Indensité énergétique","Indensité carbone"), each = 36)

ggplot() + 
  geom_bar( aes(x = x, y = z, fill = y,group = 1), stat = 'identity', position = 'stack') + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  labs(x = "year", y = "Variation de l'émission", title = "Evolution de part de variation de l'émission - Taxe sans redistribution") +
  scale_x_continuous(breaks=seq(2015,2050,5))

```
